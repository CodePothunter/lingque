# 救命！！我写的 AI 助手居然学会了自己改自己的代码？？

姐妹们！！！今天必须来分享一个我做的超疯狂的项目

我做了一个 AI 私人助手叫 **灵雀（LingQue）**，本来就是想让它帮我管管日程、聊聊天的

结果它现在——

**会自己修改自己的源代码让自己变强！！！**

而且改坏了还会自己回滚！！怎么做到的？往下看

---

## 先说它到底做了什么

简单来说就是三件事（我直接画出来了）：

```
你和它聊天
    ↓
它偷偷反思「我刚才回答得好不好？」
    ↓
反思多了发现问题 → 自己改代码修bug
    ↓
改完验证 → 没问题就保留 → 改崩了就回滚
```

听起来很离谱对吧！但是每一步都有安全机制！不是那种 AI 失控的感觉！

---

## 核心机制：三个循环

### 循环一：每次聊完天都反思

每次回复完消息，它会花不到 1 秒做一个小评估：

> 「质量:中，回答了问题但缺少示例」
> 「好奇:用户提到的那个 Rust 异步库好像很有趣」

这个评估超轻量！只用 150 个 token！但是会一条条积累下来

好奇心的部分也会被记下来，等有空了去研究（对，它会自己上网查资料学习）

### 循环二：每小时一次的「心跳」

这个是核心中的核心！！

灵雀有一个心跳调度器，**每 3600 秒（1小时）跳一次**

只在早 8 点到晚 11 点工作（深夜不搞事）

每次心跳会触发一个「自主行动周期」：

**第一步：收集所有线索**

它会把过去一段时间积累的所有信息汇总起来看：
- 最近 20 条好奇心话题
- 今天 15 条回复质量评估
- 各个工具的成功率和失败原因
- 上次改代码的结果怎么样
- 最近的 git 提交历史
- 自己的完整源代码目录结构

**第二步：AI 自己决定做什么**

它有两个选择：

A. **探索学习** — 上网搜索一个感兴趣的话题，把学到的东西记在笔记里，甚至可以给自己创建新工具

B. **自我进化** — 分析自己的源代码，找到可以改进的地方，然后真的去改！

优先级是：如果有已知的 bug 没修就先修 bug，修完了才去学新东西

而且每天最多只能改 3 次代码，不会过度折腾

**第三步：执行 + 验证**

如果选了进化路线：
1. 先保存当前代码版本（Git checkpoint）
2. 读源代码 → 分析问题 → 写修复
3. 提交 Git commit（统一前缀 `🧬【进化】：`）
4. 跑一个快速验证，确认核心模块还能正常 import
5. 更新进化日志，通知主人（就是我）

### 循环三：重启时的安全检查

万一改完代码系统崩了怎么办？？

不慌！！下次启动时会自动检测：

```
上次有进化操作 + 系统不是正常关闭的？
→ 跑 4 个核心模块的健康检查
→ 只要有一个挂了 → 自动 git reset --hard 回滚！！
→ 把「我改坏了什么」记录下来当教训
```

这个设计真的绝！！它不仅会回滚，还会**记住自己踩过的坑**，下次进化的时候能看到之前的失败记录，就不会犯同样的错误了

---

## 给你们看个真实例子

场景：灵雀发现自己的网页搜索功能老是超时

**积累阶段**（好几个小时）

反思日志里出现好几次：「工具调用失败，web_search 超时」

工具统计也显示：成功率只有 68%

**心跳触发**（某个整点）

灵雀看到这些数据，决定修一下

它读了 `web_tools.py`，发现超时写死了 10 秒

**执行进化**

- 把超时改成 30 秒
- 加了一次重试
- 提交：`🧬【进化】：增加 web_search 超时和重试`

**验证通过，记录完成**

进化日志里多了一条已完成记录

下次重启后生效，成功率从 68% 提升上去了

---

## 安全吗？会不会 AI 失控？

这个问题我被问了无数次！！答案是：**层层设防**

| 防护 | 具体措施 |
|------|----------|
| 频次限制 | 每天最多改 3 次代码 |
| 费用上限 | 进化预算 $2/天，探索 $1/天 |
| 时间限制 | 只在白天工作，晚 11 点后不干活 |
| Git 回滚 | 改之前存档，崩了自动回退 |
| 健康检查 | 4 个核心模块必须全部能跑 |
| 范围限制 | 只改代码，不碰配置和用户数据 |
| 可追溯 | 每次改动都有 Git commit 记录 |
| 教训记忆 | 失败经验永久保留，压缩但不丢弃 |

自定义工具还有额外的安全检查——用 AST 语法分析，直接禁掉 `subprocess` 之类的危险模块

---

## 日志不会越来越大吗？

会！但是有压缩机制！

- 已完成记录超过 10 条 → AI 自动摘要旧的，只保留最近 5 条
- 失败记录超过 5 条 → 提炼成教训总结，保留最近 3 条

压缩后：

```
📦 历史改进归档（2026-01 ~ 02）
- 优化了会话压缩的 token 计算
- 增强了群聊的超时处理
- 加了网页搜索的重试机制

### 最近的改进1（保留原文）
### 最近的改进2（保留原文）
...
```

重要的 commit hash 都保留了！随时可以 `git show` 查看当时具体改了什么

---

## 关键参数速查

给技术流的姐妹们：

- 心跳间隔：**1 小时**
- 活跃时段：**8:00–23:00**
- 反思 token：**150**（超轻量）
- 每日进化上限：**3 次**
- 好奇心预算：**$1/天**
- 进化预算：**$2/天**
- 健康检查超时：**15 秒/模块**

全部可以在 config.json 里调！

---

## 我的感受

说实话一开始我也觉得让 AI 改自己代码这个想法很疯

但是当我看到 git log 里出现第一条 `🧬【进化】` 前缀的 commit

然后第二天发现之前一个老是出错的功能突然好了的时候

那种感觉真的很奇妙——就好像你养了一只电子宠物，它在你睡觉的时候偷偷学习变强了

而且最让我放心的是：它每一步操作都是透明的、可追溯的、可回滚的

不是那种黑箱 AI 失控的感觉，而是一个有纪律的、谨慎的自我提升循环

---

好啦今天就分享到这里！有什么问题评论区问我

如果你也对 AI 自我进化感兴趣，代码是开源的，来看看吧

---

`#AI` `#开源` `#自我进化` `#LLM` `#个人助手` `#技术分享` `#程序员日常`
