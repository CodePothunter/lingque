# èŠå¤©å¹³å°æŠ½è±¡å±‚æ¥å£è§„èŒƒ

> LingQue å¹³å°æ— å…³é€šä¿¡åè®® v1.4
>
> æœ¬æ–‡æ¡£å®šä¹‰äº†ä¸€ä¸ªæ‹ŸäººåŒ– AI Agent åœ¨ä»»æ„é€šè®¯å¹³å°ä¸Šæ‰€éœ€çš„**æœ€å°å®Œå¤‡åŠ¨ä½œé›†**ã€‚
> ä»»ä½•æ–°å¹³å°ï¼ˆDiscordã€Telegramã€Slackã€å¾®ä¿¡ç­‰ï¼‰åªéœ€å®ç°æœ¬æ–‡æ¡£å®šä¹‰çš„æ¥å£ï¼Œå³å¯æ¥å…¥ LingQueã€‚

---

## ç›®å½•

1. [è®¾è®¡åŸåˆ™](#1-è®¾è®¡åŸåˆ™)
2. [æŠ½è±¡éœ€æ±‚ vs å¹³å°è¡¥å¿](#2-æŠ½è±¡éœ€æ±‚-vs-å¹³å°è¡¥å¿)
3. [æœ€å°å®Œå¤‡åŠ¨ä½œé›†æ€»è§ˆ](#3-æœ€å°å®Œå¤‡åŠ¨ä½œé›†æ€»è§ˆ)
4. [æ ‡å‡†åŒ–æ•°æ®ç±»å‹](#4-æ ‡å‡†åŒ–æ•°æ®ç±»å‹)
5. [èº«ä»½ â€” æˆ‘æ˜¯è°](#5-èº«ä»½--æˆ‘æ˜¯è°)
6. [æ„ŸçŸ¥ â€” æˆ‘çœ‹åˆ°äº†ä»€ä¹ˆ](#6-æ„ŸçŸ¥--æˆ‘çœ‹åˆ°äº†ä»€ä¹ˆ)
7. [è¡¨è¾¾ â€” æˆ‘è¯´äº†ä»€ä¹ˆ](#7-è¡¨è¾¾--æˆ‘è¯´äº†ä»€ä¹ˆ)
8. [å­˜åœ¨æ„Ÿ â€” æˆ‘åœ¨å¤„ç†](#8-å­˜åœ¨æ„Ÿ--æˆ‘åœ¨å¤„ç†)
9. [æ„Ÿå®˜ â€” æˆ‘çœ‹åˆ°çš„å›¾ç‰‡å’Œæ–‡ä»¶](#9-æ„Ÿå®˜--æˆ‘çœ‹åˆ°çš„å›¾ç‰‡å’Œæ–‡ä»¶)
10. [è®¤çŸ¥ â€” æˆ‘çŸ¥é“è°æ˜¯è°](#10-è®¤çŸ¥--æˆ‘çŸ¥é“è°æ˜¯è°)
11. [å¯é€‰è¡Œä¸º](#11-å¯é€‰è¡Œä¸º)
12. [èƒ½åŠ›å£°æ˜](#12-èƒ½åŠ›å£°æ˜)
13. [å¹³å°é…ç½®](#13-å¹³å°é…ç½®)
14. [å¤–éƒ¨æœåŠ¡å±‚ï¼ˆéå¹³å°æŠ½è±¡ï¼‰](#14-å¤–éƒ¨æœåŠ¡å±‚éå¹³å°æŠ½è±¡)
15. [æ ‡å‡†å¡ç‰‡ç»“æ„](#15-æ ‡å‡†å¡ç‰‡ç»“æ„)
16. [é£ä¹¦é€‚é…æŒ‡å—](#16-é£ä¹¦é€‚é…æŒ‡å—)
17. [Discord é€‚é…æŒ‡å—](#17-discord-é€‚é…æŒ‡å—)
18. [é™„å½• Aï¼šå†…æ ¸æ”¹é€ æ¸…å•](#é™„å½•-aå†…æ ¸æ”¹é€ æ¸…å•)
19. [é™„å½• Bï¼šv1.3 â†’ v1.4 å˜æ›´è®°å½•](#é™„å½•-bv13--v14-å˜æ›´è®°å½•)
20. [é™„å½• Cï¼šå†å²å˜æ›´æ‘˜è¦](#é™„å½•-cå†å²å˜æ›´æ‘˜è¦)

---

## 1. è®¾è®¡åŸåˆ™

- **æè¿°äººçš„è¡Œä¸ºï¼Œä¸æè¿° API çš„å½¢çŠ¶**ï¼šæ¥å£æŒ‰"ä¸€ä¸ªäººåœ¨èŠå¤©ä¸­åšä»€ä¹ˆ"æ¥ç»„ç»‡ï¼Œä¸æŒ‰å¹³å° API çš„æŠ€æœ¯ç»“æ„ã€‚
- **æœ€å°å®Œå¤‡**ï¼šæ¯ä¸ªæ¥å£éƒ½ä¸å¯å†æ‹†ï¼Œä¹Ÿä¸å¯ç§»é™¤ã€‚å¦‚æœå»æ‰å®ƒï¼ŒAgent å°±ä¸å†åƒä¸€ä¸ªå®Œæ•´çš„å¯¹è¯å‚ä¸è€…ã€‚
- **ä¸€ä¸ªæ„å›¾ï¼Œä¸€ä¸ªæŠ½è±¡**ï¼šå¦‚æœä¸¤ç§æœºåˆ¶æœåŠ¡äºåŒä¸€ä¸ªç›®çš„ï¼ˆå¦‚é£ä¹¦ reaction("OnIt") å’Œ Discord typing éƒ½æ˜¯"æˆ‘åœ¨å¤„ç†"ï¼‰ï¼Œå®ƒä»¬æ˜¯åŒä¸€ä¸ªæŠ½è±¡è¡Œä¸ºçš„ä¸åŒå®ç°ï¼Œä¸åº”æ‹†æˆä¸¤ä¸ªæ¥å£ã€‚
- **è¡¥å¿å¯¹å†…æ ¸é€æ˜**ï¼šå¹³å°ç‰¹æœ‰çš„è¡¥å¿è¡Œä¸ºï¼ˆè½®è¯¢ã€èº«ä»½æ¨æ–­ã€æ ¼å¼è½¬æ¢ï¼‰å°è£…åœ¨é€‚é…å™¨å†…éƒ¨ã€‚
- **èƒ½åŠ›å£°æ˜åˆ¶**ï¼šé€‚é…å™¨å£°æ˜è‡ªèº«èƒ½åŠ›ï¼Œå†…æ ¸æ®æ­¤é™çº§ã€‚
- **å¼‚æ­¥ä¼˜å…ˆ**ï¼šæ‰€æœ‰ I/O å‡ä¸º `async def`ã€‚

---

## 2. æŠ½è±¡éœ€æ±‚ vs å¹³å°è¡¥å¿

æŠ½è±¡æ¥å£åªå®šä¹‰**Agent éœ€è¦ä»€ä¹ˆ**ï¼Œä¸å®šä¹‰**å¹³å°æ€ä¹ˆæ»¡è¶³**ã€‚

```
Agent è¯´: "ç»™æˆ‘æ‰€æœ‰æ¶ˆæ¯"
  é£ä¹¦é€‚é…å™¨: WS æ”¶ä¸€åŠ + REST è½®è¯¢è¡¥å¦ä¸€åŠ â†’ ç»Ÿä¸€æŠ•å…¥äº‹ä»¶é˜Ÿåˆ—
  Discord é€‚é…å™¨: Gateway ç›´æ¥å…¨æ”¶ â†’ æŠ•å…¥äº‹ä»¶é˜Ÿåˆ—
  Agent çœ‹åˆ°çš„: äº‹ä»¶é˜Ÿåˆ—é‡Œæºæºä¸æ–­çš„ IncomingMessageï¼Œä¸€è§†åŒä»

Agent è¯´: "å‘Šè¯‰ä»–ä»¬æˆ‘åœ¨æƒ³"
  é£ä¹¦é€‚é…å™¨: add_reaction("OnIt")
  Discord é€‚é…å™¨: trigger_typing() + add_reaction("â³")
  Telegram é€‚é…å™¨: send_chat_action("typing")
  Agent çœ‹åˆ°çš„: è°ƒäº†ä¸€ä¸ªæ–¹æ³•ï¼Œæ‹¿åˆ° handleï¼Œå¤„ç†å®Œåæ¸…æ‰
```

ä»¥ä¸‹è¡Œä¸ºæ˜¯é£ä¹¦è¡¥å¿ï¼Œ**ä¸åœ¨æŠ½è±¡æ¥å£ä¸­å‡ºç°**ï¼š

| é£ä¹¦é™åˆ¶ | è¡¥å¿è¡Œä¸º | å…¶ä»–å¹³å°ä¸éœ€è¦çš„åŸå›  |
|---------|---------|-------------------|
| WS ä¸æ¨ bot æ¶ˆæ¯ | REST è½®è¯¢è¡¥æ¼ | Discord/Telegram äº‹ä»¶æµå¤©ç„¶åŒ…å«æ‰€æœ‰æ¶ˆæ¯ |
| bot è¿”å› app_id (cli_xxx) | æ—¶åº/æ’é™¤æ³•æ¨æ–­èº«ä»½ | å…¶ä»–å¹³å° bot æœ‰ç»Ÿä¸€ ID |
| ç¾¤æˆå‘˜ API ä¸å« bot ä¿¡æ¯ | æ¶ˆæ¯ä¿¡å·é€æ­¥æ³¨å†Œ | Guild.members ç›´æ¥å®Œæ•´ |
| æ— æ˜ç¡®é€€ç¾¤äº‹ä»¶ | HTTP 400 å‰¯ä½œç”¨æ¨æ–­ | on_guild_remove / my_chat_member |
| æ–‡æœ¬æ¶ˆæ¯ä¸æ¸²æŸ“ Markdown | æ£€æµ‹ â†’ è‡ªåŠ¨åˆ‡å¡ç‰‡ | Discord/Telegram åŸç”Ÿ Markdown |
| @ç”¨ å ä½ç¬¦ @_user_N | æŸ¥ mentions æ•°ç»„æ›¿æ¢ | `<@id>` æ ¼å¼æ›´ç›´æ¥ |
| Token 2 å°æ—¶è¿‡æœŸ | è‡ªåŠ¨åˆ·æ–° | Bot Token é•¿æœŸæœ‰æ•ˆ |

---

## 3. æœ€å°å®Œå¤‡åŠ¨ä½œé›†æ€»è§ˆ

ä¸€ä¸ªäººåœ¨èŠå¤©ä¸­åšçš„æ‰€æœ‰äº‹æƒ…ï¼Œå½’çº³ä¸º 6 å±‚ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èº«ä»½ (Identity)     æˆ‘æ˜¯è°                   â”‚  1 æ–¹æ³•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„ŸçŸ¥ (Perception)   æˆ‘çœ‹åˆ°äº†ä»€ä¹ˆ              â”‚  1 äº‹ä»¶æµ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¡¨è¾¾ (Expression)   æˆ‘è¯´äº†ä»€ä¹ˆ               â”‚  1 æ–¹æ³•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­˜åœ¨æ„Ÿ (Presence)   æˆ‘åœ¨å¤„ç†                 â”‚  2 æ–¹æ³•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„Ÿå®˜ (Senses)       æˆ‘çœ‹åˆ°çš„å›¾ç‰‡å’Œæ–‡ä»¶         â”‚  1 æ–¹æ³•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è®¤çŸ¥ (Cognition)    æˆ‘çŸ¥é“è°æ˜¯è°              â”‚  2 æ–¹æ³•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  æ ¸å¿ƒ: 8 ä¸ªæŠ½è±¡åŠ¨ä½œ + 1 ä¸ªäº‹ä»¶æµ
```

| å±‚ | æŠ½è±¡åŠ¨ä½œ | æ–¹æ³•ç­¾å | ä¸ºä»€ä¹ˆä¸å¯å»æ‰ |
|----|---------|---------|-------------|
| èº«ä»½ | æˆ‘æ˜¯è° | `get_identity() â†’ BotIdentity` | ä¸çŸ¥é“è‡ªå·±æ˜¯è°ï¼Œæ— æ³•è¿‡æ»¤è‡ªå·±çš„æ¶ˆæ¯ |
| æ„ŸçŸ¥ | æˆ‘çœ‹åˆ°äº†ä»€ä¹ˆ | äº‹ä»¶æµ â†’ `asyncio.Queue` | ä¸æ„ŸçŸ¥å¤–ç•Œå°±æ— æ³•å­˜åœ¨ |
| è¡¨è¾¾ | æˆ‘è¯´äº†ä»€ä¹ˆ | `send(OutgoingMessage) â†’ str?` | ä¸èƒ½è¯´è¯çš„ Agent æ²¡æœ‰æ„ä¹‰ |
| å­˜åœ¨æ„Ÿ | æˆ‘åœ¨æƒ³ | `start_thinking(message_id) â†’ handle` | äººæ”¶åˆ°æ¶ˆæ¯åä¼šæ˜¾ç¤º"æ­£åœ¨å¤„ç†" |
| å­˜åœ¨æ„Ÿ | æˆ‘æƒ³å®Œäº† | `stop_thinking(message_id, handle)` | å¤„ç†å®Œæˆï¼Œæ¸…é™¤å¤„ç†ä¸­ä¿¡å· |
| æ„Ÿå®˜ | æˆ‘çœ‹åˆ°äº†å›¾ç‰‡ | `fetch_media(msg_id, key) â†’ (data, mime)` | å¤šæ¨¡æ€ç†è§£èƒ½åŠ› |
| è®¤çŸ¥ | è¿™æ˜¯è° | `resolve_name(user_id) â†’ str` | å¯¹è¯ä¸­å¿…é¡»çŸ¥é“å¯¹æ–¹å«ä»€ä¹ˆ |
| è®¤çŸ¥ | ç¾¤é‡Œæœ‰è° | `list_members(chat_id) â†’ [Member]` | ç¾¤èŠéœ€è¦çŸ¥é“å‚ä¸è€… |

### å¯é€‰è¡Œä¸ºï¼ˆæœ‰åˆ™æ›´å¥½ï¼Œæ— åˆ™é™çº§ï¼‰

| è¡Œä¸º | æ–¹æ³• | é™çº§ç­–ç•¥ |
|------|------|---------|
| è¡¨æƒ…å›åº” | `react(message_id, emoji) â†’ handle` | è·³è¿‡ |
| æ’¤é”€è¡¨æƒ… | `unreact(message_id, handle)` | è·³è¿‡ |
| æ”¹å£ | `edit(message_id, new_content) â†’ bool` | å‘æ–°æ¶ˆæ¯æ›´æ­£ |
| æ’¤å› | `unsend(message_id) â†’ bool` | ä¸æ’¤å› |
| æŒ‰é’®äº¤äº’ | `card.action` äº‹ä»¶ | æ–‡å­—ç¡®è®¤ |

### v1.2 â†’ v1.3 å…³é”®å˜æ›´

**react/unreact ä¸ºä»€ä¹ˆä»æ ¸å¿ƒé™ä¸ºå¯é€‰ï¼Ÿ**

v1.2 å°† `react/unreact` åˆ—ä¸ºæ ¸å¿ƒï¼ŒåŒæ—¶å°† `show_typing` åˆ—ä¸ºå¯é€‰ï¼Œä½†å®é™…ä»£ç ä¸­ reaction çš„**ä¸»è¦ç”¨é€”**å°±æ˜¯"æ­£åœ¨å¤„ç†"æŒ‡ç¤ºå™¨ï¼ˆé£ä¹¦çš„ `add_reaction("OnIt")`ï¼‰ã€‚è¿™å’Œ Discord çš„ `trigger_typing()` æ˜¯**åŒä¸€ä¸ªæ„å›¾çš„ä¸åŒå®ç°**ã€‚

v1.3 çš„ä¿®æ­£ï¼š
- æå–"æ­£åœ¨å¤„ç†"è¿™ä¸ª**æ„å›¾**ä¸ºæ ¸å¿ƒæŠ½è±¡ â†’ `start_thinking` / `stop_thinking`
- é€‚é…å™¨è‡ªè¡Œé€‰æ‹©å®ç°æœºåˆ¶ï¼ˆreactionã€typing indicatorã€chat action...ï¼‰
- ä¸€èˆ¬æ€§çš„ emoji è¡¨æƒ…å›åº”ï¼ˆğŸ‘ã€â¤ï¸ï¼‰é™ä¸ºå¯é€‰ â€” ç¼ºå°‘å®ƒ Agent ä»èƒ½å®Œæ•´å¯¹è¯

---

## 4. æ ‡å‡†åŒ–æ•°æ®ç±»å‹

### 4.1 æšä¸¾

```python
class ChatType(str, Enum):
    PRIVATE = "private"       # ä¸€å¯¹ä¸€ç§èŠ
    GROUP = "group"           # å¤šäººç¾¤èŠ

class SenderType(str, Enum):
    USER = "user"             # äººç±»
    BOT = "bot"               # æœºå™¨äºº

class MessageType(str, Enum):
    TEXT = "text"             # çº¯æ–‡æœ¬
    IMAGE = "image"           # å›¾ç‰‡
    RICH_TEXT = "rich_text"   # å¯Œæ–‡æœ¬
    FILE = "file"             # æ–‡ä»¶
    AUDIO = "audio"           # è¯­éŸ³
    VIDEO = "video"           # è§†é¢‘
    STICKER = "sticker"       # è´´çº¸
    SHARE = "share"           # åˆ†äº«ï¼ˆé“¾æ¥/ç¾¤/åç‰‡ï¼‰
    UNKNOWN = "unknown"       # æœªè¯†åˆ«
```

### 4.2 Mention â€” @æåŠ

```python
@dataclass
class Mention:
    user_id: str
    name: str
    is_bot_self: bool         # æ˜¯å¦ @äº†æœ¬ bot
```

### 4.3 IncomingMessage â€” æ„ŸçŸ¥åˆ°çš„æ¶ˆæ¯

é€‚é…å™¨å¿…é¡»å°†å¹³å°åŸå§‹æ¶ˆæ¯**å®Œæ•´è½¬æ¢**ä¸ºæ­¤æ ¼å¼ã€‚å†…æ ¸ä¸æ¥è§¦ä»»ä½•å¹³å°åŸå§‹å¯¹è±¡ã€‚

```python
@dataclass
class IncomingMessage:
    message_id: str
    chat_id: str
    chat_type: ChatType
    sender_id: str
    sender_type: SenderType
    sender_name: str              # é€‚é…å™¨å¿…é¡»å¡«å……çœŸå
    message_type: MessageType
    text: str                     # å·²å®Œæˆå ä½ç¬¦æ›¿æ¢çš„æœ€ç»ˆæ–‡æœ¬ï¼ˆMarkdownï¼‰
    mentions: list[Mention]       # å·²è§£æçš„ @åˆ—è¡¨
    is_mention_bot: bool
    image_keys: list[str]         # åª’ä½“èµ„æºæ ‡è¯†
    reply_to_id: str = ""         # æ­¤æ¶ˆæ¯å¼•ç”¨å›å¤çš„ç›®æ ‡æ¶ˆæ¯ IDï¼ˆç©º = éå›å¤ï¼‰
    timestamp: int                # Unix æ¯«ç§’
    raw: Any = None               # å†…æ ¸ä¸è®¿é—®
```

**é€‚é…å™¨ç¡¬æ€§è¦æ±‚ï¼š**
1. `text` â€” æ‰€æœ‰å ä½ç¬¦å·²æ›¿æ¢ä¸º `@çœŸå`ï¼Œæœ¬ bot çš„ @ å·²ç§»é™¤
2. `sender_name` â€” çœŸåï¼Œä¸å…è®¸è¿”å› `cli_xxx`ã€`ou_xxx` ç­‰åŸå§‹ ID
3. `sender_type` â€” æ­£ç¡®åŒºåˆ† USER / BOT
4. æ¶ˆæ¯å»é‡ â€” é€‚é…å™¨çš„è´£ä»»

### 4.4 OutgoingMessage â€” è¦è¯´çš„è¯

ä¸€ä¸ªäººè¯´è¯æ—¶ä¸ä¼šæƒ³"æˆ‘è°ƒå“ªä¸ª API"ã€‚ä»–å°±æ˜¯**è¯´äº†ä¸€å¥è¯**ï¼Œå¯èƒ½å›å¤æŸæ¡ï¼Œå¯èƒ½å¸¦æ ¼å¼ã€‚

```python
@dataclass
class OutgoingMessage:
    chat_id: str
    text: str = ""                       # Markdown æ–‡æœ¬ï¼ˆå§‹ç»ˆå¡«å……ï¼Œä½œä¸ºå†…å®¹å’Œé™çº§åå¤‡ï¼‰
    reply_to: str = ""                   # å¼•ç”¨å›å¤çš„æ¶ˆæ¯ IDï¼ˆç©º = ä¸å¼•ç”¨ï¼‰
    mentions: list[Mention] = field(default_factory=list)  # éœ€è¦ @çš„äºº
    card: dict | None = None             # ç»“æ„åŒ–å¡ç‰‡ï¼ˆå¯é€‰ï¼Œè§ Â§15ï¼‰
```

**å†…å®¹åˆ†å‘è§„åˆ™ï¼ˆé€‚é…å™¨æ‰§è¡Œï¼‰ï¼š**

```
OutgoingMessage åˆ°è¾¾é€‚é…å™¨
â”‚
â”œâ”€ card éç©ºï¼Ÿ
â”‚   â”œâ”€ æ˜¯ + has_rich_cards â†’ æ¸²æŸ“ä¸ºå¹³å°åŸç”Ÿå¡ç‰‡ï¼ˆé£ä¹¦ interactive / Discord Embedï¼‰
â”‚   â””â”€ æ˜¯ + !has_rich_cards â†’ å¿½ç•¥ cardï¼Œä½¿ç”¨ text ä½œä¸ºé™çº§
â”‚
â”œâ”€ card ä¸ºç©º
â”‚   â”œâ”€ has_markdown â†’ å‘é€ textï¼Œä¿ç•™ Markdown æ ¼å¼
â”‚   â””â”€ !has_markdown â†’ strip Markdown åå‘çº¯æ–‡æœ¬
â”‚       ï¼ˆé£ä¹¦è¡¥å¿ï¼šæ£€æµ‹åˆ°ä»£ç å—ç­‰å¤æ‚æ ¼å¼æ—¶è‡ªåŠ¨åˆ‡å¡ç‰‡ï¼‰
â”‚
â”œâ”€ reply_to éç©ºï¼Ÿ
â”‚   â”œâ”€ has_reply â†’ å¼•ç”¨å›å¤
â”‚   â””â”€ !has_reply â†’ é™çº§ä¸ºæ™®é€šå‘é€
â”‚
â””â”€ mentions éç©ºï¼Ÿ
    â””â”€ å°† @name è½¬æ¢ä¸ºå¹³å°åŸç”Ÿæ ¼å¼ï¼ˆé£ä¹¦ <at> / Discord <@id>ï¼‰
```

**æ ¸å¿ƒçº¦æŸï¼š`text` å§‹ç»ˆæœ‰æ„ä¹‰ã€‚** æ— è®ºæ˜¯å¦é™„å¸¦ cardï¼Œ`text` éƒ½åº”åŒ…å«å®Œæ•´çš„æ–‡å­—å†…å®¹ã€‚`card` æ˜¯åŒä¸€ä¿¡æ¯çš„**ç»“æ„åŒ–å¢å¼ºå‘ˆç°**ï¼Œä¸æ˜¯ç‹¬ç«‹äº `text` çš„å¦ä¸€æ¡æ¶ˆæ¯ã€‚å½“å¹³å°ä¸æ”¯æŒå¡ç‰‡æ—¶ï¼Œ`text` å°±æ˜¯å…¨éƒ¨å†…å®¹ï¼Œä¸ä¼šä¸¢å¤±ä¿¡æ¯ã€‚

**ä¸ v1.1 çš„ 5 ä¸ªæ–¹æ³•çš„å¯¹åº”å…³ç³»ï¼š**

| v1.1 æ–¹æ³• | v1.3 ç­‰ä»· |
|-----------|----------|
| `send_text(chat_id, text)` | `send(OutgoingMessage(chat_id, text))` |
| `reply_text(msg_id, text)` | `send(OutgoingMessage(chat_id, text, reply_to=msg_id))` |
| `send_card(chat_id, card)` | `send(OutgoingMessage(chat_id, text, card=card))` |
| `reply_card(msg_id, card)` | `send(OutgoingMessage(chat_id, text, reply_to=msg_id, card=card))` |
| `format_mention(user_id)` | `OutgoingMessage.mentions` å­—æ®µ |

### 4.5 BotIdentity â€” æˆ‘æ˜¯è°

```python
@dataclass
class BotIdentity:
    bot_id: str
    bot_name: str
```

### 4.6 ChatMember â€” ç¾¤é‡Œçš„äºº

```python
@dataclass
class ChatMember:
    user_id: str
    name: str
    is_bot: bool
```

### 4.7 Reaction â€” è¡¨æƒ…å›åº”

```python
@dataclass
class Reaction:
    reaction_id: str
    chat_id: str              # æ‰€å±ä¼šè¯ï¼ˆé€‚é…å™¨å¿…é¡»å¡«å……ï¼Œå†…æ ¸ä¸åº”è‡ªè¡ŒåæŸ¥ï¼‰
    message_id: str
    emoji: str
    operator_id: str
    operator_type: SenderType
```

> **v1.4 å˜æ›´**ï¼šæ–°å¢ `chat_id` å­—æ®µã€‚å†…æ ¸éœ€è¦ `chat_id` æ¥æ›´æ–° bot åä½œçš„ thinking_signals æ˜ å°„è¡¨ã€‚
> v1.3 ä¸­ Reaction åªæœ‰ `message_id`ï¼Œå†…æ ¸è¢«è¿«éå†æ¶ˆæ¯ç¼“å†²åŒºåæŸ¥æ‰€å±ç¾¤èŠï¼ˆO(n)ï¼Œä¸”æ¶ˆæ¯ä¸åœ¨ç¼“å†²åŒºæ—¶ç›´æ¥ä¸¢å¼ƒï¼‰ã€‚
> é€‚é…å™¨ç¦»å¹³å°æ›´è¿‘ï¼Œå¡«å…… `chat_id` çš„æˆæœ¬æ›´ä½ã€‚

### 4.8 CardAction â€” æŒ‰é’®äº¤äº’

```python
@dataclass
class CardAction:
    action_type: str          # "confirm" / "cancel" / "button_click"
    value: dict
    operator_id: str
    message_id: str = ""
```

---

## 5. èº«ä»½ â€” æˆ‘æ˜¯è°

```python
class PlatformAdapter(ABC):

    @property
    @abstractmethod
    def capabilities(self) -> PlatformCapabilities:
        """æˆ‘èƒ½åšä»€ä¹ˆã€‚

        å†…æ ¸é€šè¿‡æ­¤å±æ€§è·å–é€‚é…å™¨çš„èƒ½åŠ›å£°æ˜ï¼Œæ®æ­¤å†³å®šé™çº§ç­–ç•¥ã€‚
        è¿”å›å€¼åº”ä¸ºå¸¸é‡ï¼Œä¸éšè¿è¡Œæ—¶å˜åŒ–ã€‚
        """
        ...

    @abstractmethod
    async def get_identity(self) -> BotIdentity:
        """æˆ‘æ˜¯è°ã€‚

        å¯åŠ¨æ—¶è°ƒç”¨ã€‚å†…æ ¸ç”¨ bot_id è¿‡æ»¤è‡ªå·±çš„æ¶ˆæ¯ã€‚
        """
        ...
```

---

## 6. æ„ŸçŸ¥ â€” æˆ‘çœ‹åˆ°äº†ä»€ä¹ˆ

### 6.1 è¿æ¥

```python
    @abstractmethod
    async def connect(self, queue: asyncio.Queue) -> None:
        """å¼€å§‹æ„ŸçŸ¥ä¸–ç•Œã€‚

        é€‚é…å™¨å»ºç«‹ä¸å¹³å°çš„è¿æ¥ï¼Œå°†æ‰€æœ‰äº‹ä»¶è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼åæŠ•å…¥ queueã€‚

        æ ¸å¿ƒå¥‘çº¦ï¼š
        - queue ä¸­å¿…é¡»åŒ…å«ä¼šè¯ä¸­**æ‰€æœ‰å‚ä¸è€…çš„æ¶ˆæ¯**ï¼ˆå«å…¶ä»– botï¼‰
        - å¦‚å¹³å°åŸç”Ÿä¸æ¨ bot æ¶ˆæ¯ï¼Œé€‚é…å™¨å†…éƒ¨è¡¥å¿ï¼Œå¯¹å†…æ ¸é€æ˜
        - æ¶ˆæ¯å»é‡ã€token ç®¡ç†ç­‰å…¨éƒ¨åœ¨é€‚é…å™¨å†…éƒ¨å®Œæˆ

        è¿æ¥ç¨³å®šæ€§å¥‘çº¦ï¼š
        - é€‚é…å™¨è´Ÿè´£ç»´æŠ¤è¿æ¥çš„å­˜æ´»æ€§
        - è¿æ¥æ–­å¼€æ—¶é€‚é…å™¨å¿…é¡»è‡ªåŠ¨é‡è¿ï¼ˆæŒ‡æ•°é€€é¿ï¼‰ï¼Œå¯¹å†…æ ¸é€æ˜
        - é‡è¿æœŸé—´ä¸å‘ queue æŠ•é€’ä»»ä½•äº‹ä»¶ï¼ˆå†…æ ¸æ— æ„ŸçŸ¥ï¼‰ï¼Œé‡è¿æˆåŠŸåæ¢å¤
        - å¦‚æœé‡è¿æŒç»­å¤±è´¥ï¼ˆè¾¾åˆ°ä¸Šé™ï¼‰ï¼Œå‘ queue æŠ•é€’ä¸€ä¸ªç‰¹æ®Šäº‹ä»¶é€šçŸ¥å†…æ ¸
        - å†…æ ¸åªè°ƒç”¨ä¸€æ¬¡ connect()ï¼Œä¸è´Ÿè´£ç›‘æ§æˆ–é‡å¯è¿æ¥
        """
        ...

    @abstractmethod
    async def disconnect(self) -> None:
        """åœæ­¢æ„ŸçŸ¥ï¼Œé‡Šæ”¾èµ„æºã€‚ä¼˜é›…å…³é—­åº•å±‚è¿æ¥ã€‚"""
        ...
```

### 6.2 æ ‡å‡†äº‹ä»¶ç±»å‹

é€‚é…å™¨å°†ä¸€åˆ‡å¤–éƒ¨å‘ç”Ÿçš„äº‹æƒ…å½’ä¸€åŒ–ä¸ºä»¥ä¸‹äº‹ä»¶æŠ•å…¥é˜Ÿåˆ—ï¼š

```python
# â”€â”€ æœ‰äººè¯´è¯äº† â”€â”€
{
    "event_type": "message",
    "message": IncomingMessage,
}

# â”€â”€ æœ‰äººå¯¹æ¶ˆæ¯åšå‡ºååº” â”€â”€
{
    "event_type": "reaction",
    "reaction": Reaction,
}

# â”€â”€ ç¾¤ç»„æˆå‘˜å˜åŠ¨ â”€â”€
{
    "event_type": "member_change",
    "chat_id": str,
    "change_type": "bot_joined"      # bot_joined / bot_left / user_joined / user_left
    "users": [{"user_id": str, "name": str}],  # å˜åŠ¨æ¶‰åŠçš„ç”¨æˆ·ï¼ˆbot_joined/left æ—¶ä¸ºç©ºåˆ—è¡¨ï¼‰
}

# â”€â”€ æœ‰äººç‚¹äº†æŒ‰é’®ï¼ˆå¯é€‰èƒ½åŠ›ï¼‰â”€â”€
{
    "event_type": "interaction",
    "action": CardAction,
}

# â”€â”€ å†…æ ¸å†…éƒ¨å®šæ—¶äº‹ä»¶ï¼ˆéå¹³å°äº§ç”Ÿï¼‰â”€â”€
{
    "event_type": "internal_timer",
    "chat_id": str,
    "timer_type": str,               # "eval_timeout" / "debounce" / etc.
}
```

**å…³äº reaction äº‹ä»¶ä¸ bot åä½œï¼š**

å†…æ ¸é€šè¿‡ç›‘å¬ `reaction` äº‹ä»¶æ¥æ„ŸçŸ¥å…¶ä»– bot çš„å¤„ç†çŠ¶æ€ã€‚å½“é€‚é…å™¨çš„ `start_thinking` å®ç°ä½¿ç”¨ reaction æœºåˆ¶æ—¶ï¼ˆå¦‚é£ä¹¦ï¼‰ï¼Œè¯¥ reaction ä¼šè‡ªç„¶äº§ç”Ÿ `reaction` äº‹ä»¶ï¼Œè¢«å…¶ä»– bot å®ä¾‹æ¥æ”¶ã€‚å†…æ ¸æ®æ­¤åˆ¤æ–­"å·²æœ‰äººåœ¨å¤„ç†"ï¼Œé¿å…é‡å¤å›ç­”ã€‚è¿™æ˜¯ç°æœ‰ `_thinking_signals` æœºåˆ¶çš„è‡ªç„¶å»¶ç»­ï¼Œæ— éœ€é¢å¤–äº‹ä»¶ç±»å‹ã€‚

### 6.3 æ¶ˆæ¯å®Œæ•´æ€§å¥‘çº¦

> **é€‚é…å™¨å¿…é¡»ä¿è¯äº‹ä»¶é˜Ÿåˆ—ä¸­æ”¶åˆ°ä¼šè¯ä¸­çš„å…¨éƒ¨æ¶ˆæ¯ï¼Œæ— è®ºå‘é€è€…æ˜¯äººç±»è¿˜æ˜¯ botã€‚**

| å¹³å° | å¦‚ä½•æ»¡è¶³ |
|------|---------|
| é£ä¹¦ | WS æ¨äººç±»æ¶ˆæ¯ + åå°è½®è¯¢ REST è¡¥ bot æ¶ˆæ¯ |
| Discord | Gateway ç›´æ¥å…¨æ¨ |
| Telegram | Bot API ç›´æ¥å…¨æ¨ |
| Slack | Events API ç›´æ¥å…¨æ¨ |

### 6.4 æˆå‘˜å˜åŠ¨æ£€æµ‹

> **é€‚é…å™¨å¿…é¡»åœ¨æ£€æµ‹åˆ°æˆå‘˜å˜åŠ¨æ—¶æŠ•é€’ `member_change` äº‹ä»¶ã€‚**

| å¹³å° | å¦‚ä½•æ£€æµ‹ |
|------|---------|
| é£ä¹¦ | WS äº‹ä»¶ + HTTP 400 å‰¯ä½œç”¨æ¨æ–­é€€ç¾¤ |
| Discord | `on_member_join` / `on_member_remove` / `on_guild_remove` |
| Telegram | `chat_member_updated` |

---

## 7. è¡¨è¾¾ â€” æˆ‘è¯´äº†ä»€ä¹ˆ

```python
    @abstractmethod
    async def send(self, message: OutgoingMessage) -> str | None:
        """è¯´è¯ã€‚

        ç»Ÿä¸€çš„æ¶ˆæ¯å‘é€æ¥å£ã€‚é€‚é…å™¨æ ¹æ® OutgoingMessage çš„å­—æ®µå†³å®šæœ€ç»ˆå½¢å¼ã€‚
        è¯¦ç»†çš„å†…å®¹åˆ†å‘è§„åˆ™è§ Â§4.4ã€‚

        æ¶ˆæ¯è¶…é•¿å¤„ç†ï¼ˆé€‚é…å™¨èŒè´£ï¼‰ï¼š
        - å½“ text è¶…è¿‡ max_message_length æ—¶ï¼Œé€‚é…å™¨è‡ªè¡Œå†³å®šç­–ç•¥ï¼š
          a) è‡ªåŠ¨åˆ†æ¡å‘é€ï¼ˆæ¨èï¼Œåœ¨æ®µè½/æ¢è¡Œå¤„åˆ†å‰²ï¼‰
          b) æˆªæ–­ + å°¾éƒ¨è¿½åŠ æˆªæ–­æç¤º
          c) è½¬ä¸ºå¡ç‰‡/Embedï¼ˆå¦‚æœ has_rich_cards ä¸”å¡ç‰‡å®¹é‡æ›´å¤§ï¼‰
        - å†…æ ¸ä¸å…³å¿ƒå…·ä½“ç­–ç•¥ï¼Œåªè¦ä¿¡æ¯ä¸ä¸¢å¤±
        - åˆ†æ¡å‘é€æ—¶è¿”å›æœ€åä¸€æ¡çš„ message_id

        Returns:
            å‘é€æˆåŠŸè¿”å› message_idï¼Œå¤±è´¥è¿”å› Noneã€‚
        """
        ...
```

---

## 8. å­˜åœ¨æ„Ÿ â€” æˆ‘åœ¨å¤„ç†

äººç±»åœ¨èŠå¤©ä¸­æ”¶åˆ°ä¸€æ¡éœ€è¦æ—¶é—´å¤„ç†çš„æ¶ˆæ¯æ—¶ï¼Œä¼šå‘å‡º"æˆ‘åœ¨çœ‹äº†"çš„ä¿¡å·ã€‚
è¿™ä¸ªä¿¡å·çš„**æœºåˆ¶**å› å¹³å°è€Œå¼‚ï¼Œä½†**æ„å›¾**å®Œå…¨ç›¸åŒï¼š

| å¹³å° | "æˆ‘åœ¨å¤„ç†"çš„æœºåˆ¶ |
|------|---------------|
| é£ä¹¦ | `add_reaction("OnIt")` â€” æ²¡æœ‰ typing æŒ‡ç¤ºå™¨ï¼Œç”¨ reaction æ›¿ä»£ |
| Discord | `trigger_typing()` + å¯é€‰ `add_reaction("â³")` |
| Telegram | `send_chat_action("typing")` |
| Slack | æ— åŸç”Ÿ typing for bots â€” å¯ reaction æˆ–è·³è¿‡ |

v1.2 å°†è¿™äº›æ‹†æˆäº†ä¸¤ä¸ªç‹¬ç«‹æ¦‚å¿µï¼šæ ¸å¿ƒçš„ `react/unreact` å’Œå¯é€‰çš„ `show_typing`ã€‚
ä½†å®ƒä»¬æœåŠ¡äº**åŒä¸€ä¸ªæ„å›¾**ã€‚v1.3 å°†å…¶ç»Ÿä¸€ä¸ºï¼š

```python
    @abstractmethod
    async def start_thinking(self, message_id: str) -> str | None:
        """è¡¨è¾¾"æˆ‘æ”¶åˆ°äº†ï¼Œæ­£åœ¨å¤„ç†"ã€‚

        æ”¶åˆ°æ¶ˆæ¯åã€å¼€å§‹é•¿æ—¶é—´å¤„ç†å‰è°ƒç”¨ã€‚
        é€‚é…å™¨é€‰æ‹©å¹³å°ä¸Šæœ€åˆé€‚çš„æœºåˆ¶æ¥è¡¨è¾¾è¿™ä¸ªæ„å›¾ã€‚

        å¥‘çº¦ï¼ˆMUSTï¼‰ï¼š
        - ä¿¡å·å¿…é¡»å¯¹ä¼šè¯ä¸­å…¶ä»–å‚ä¸è€…å¯è§ï¼ˆå«å…¶ä»– botï¼‰
        - å¦‚æœåŒä¸€ä¸ªç¾¤èŠä¸­éƒ¨ç½²äº†å¤šä¸ª botï¼Œä¿¡å·å¿…é¡»ä½¿ç”¨èƒ½äº§ç”Ÿ
          `reaction` äº‹ä»¶çš„æœºåˆ¶ï¼ˆå¦‚ add_reactionï¼‰ï¼Œä»¥ä¾¿å…¶ä»– bot
          çš„é€‚é…å™¨æ¥æ”¶åˆ°è¯¥äº‹ä»¶ï¼Œå†…æ ¸æ®æ­¤åˆ¤æ–­"å·²æœ‰äººåœ¨å¤„ç†"

        ä¸ºä»€ä¹ˆå¿…é¡»ç”¨ reaction è€Œé typingï¼š
        - typing indicator æ˜¯å•å‘çš„ï¼ˆåªæœ‰äººç±»èƒ½çœ‹åˆ°ï¼‰ï¼Œbot æ— æ³•ç›‘å¬
        - reaction æ˜¯åŒå‘çš„ï¼ˆäº§ç”Ÿäº‹ä»¶ï¼Œå…¶ä»– bot èƒ½é€šè¿‡ WS æ”¶åˆ°ï¼‰
        - å³ä½¿å¹³å°æ”¯æŒ typingï¼Œä¹Ÿåº”**åŒæ—¶**æ·»åŠ  reaction ç”¨äº bot åä½œ

        å®ç°å‚è€ƒï¼š
        - é£ä¹¦: add_reaction("OnIt") â€” æ—  typingï¼Œreaction æ˜¯å”¯ä¸€é€‰æ‹©
        - Discord: trigger_typing() + add_reaction("â³") â€” åŒé‡ä¿¡å·
        - Telegram: add_reaction("â³") + send_chat_action("typing")
        - å• bot åœºæ™¯ / æœ¬åœ°ç»ˆç«¯: æ— éœ€ reactionï¼Œç©ºæ“ä½œå³å¯

        Returns:
            handleï¼ˆä¼ ç»™ stop_thinking ç”¨äºæ¸…é™¤ï¼‰ï¼Œå¤±è´¥è¿”å› Noneã€‚
        """
        ...

    @abstractmethod
    async def stop_thinking(self, message_id: str, handle: str) -> None:
        """æ¸…é™¤"æ­£åœ¨å¤„ç†"ä¿¡å·ã€‚

        å›å¤å®Œæˆåè°ƒç”¨ã€‚å¦‚æœ start_thinking ä½¿ç”¨äº† reactionï¼Œ
        åˆ™æ­¤æ–¹æ³•ç§»é™¤è¯¥ reactionï¼›å¦‚æœç”¨çš„æ˜¯ typingï¼Œåˆ™è‡ªç„¶æ¶ˆå¤±ï¼Œæ­¤æ–¹æ³•ä¸ºç©ºæ“ä½œã€‚
        """
        ...
```

**å…¸å‹ä½¿ç”¨æ¨¡å¼ï¼ˆä¸ç°æœ‰ä»£ç å®Œå…¨ä¸€è‡´ï¼‰ï¼š**

```python
# å½“å‰ router.py:
reaction_id = await self.sender.add_reaction(message_id, self._thinking_emoji)
try:
    reply = await self._reply_with_tool_loop(...)
finally:
    if reaction_id:
        await self.sender.remove_reaction(message_id, reaction_id)

# æŠ½è±¡å:
handle = await adapter.start_thinking(message_id)
try:
    reply = await self._reply_with_tool_loop(...)
finally:
    if handle:
        await adapter.stop_thinking(message_id, handle)
```

å†…æ ¸ä»£ç **é›¶é€»è¾‘å˜æ›´**ï¼Œåªæ¢äº†æ–¹æ³•åã€‚ä½†é€‚é…å™¨è·å¾—äº†è‡ªç”± â€” ä¸å†è¢«è¿«ä½¿ç”¨ reaction æœºåˆ¶ã€‚

---

## 9. æ„Ÿå®˜ â€” æˆ‘çœ‹åˆ°çš„å›¾ç‰‡å’Œæ–‡ä»¶

```python
    @abstractmethod
    async def fetch_media(
        self, message_id: str, resource_key: str,
    ) -> tuple[str, str] | None:
        """è·å–æ¶ˆæ¯ä¸­çš„åª’ä½“å†…å®¹ã€‚

        Args:
            resource_key: æ¥è‡ª IncomingMessage.image_keys

        Returns:
            (base64_data, mime_type) æˆ– None

        é€‚é…å™¨èŒè´£ï¼š
        - é‰´æƒä¸‹è½½ï¼ˆé£ä¹¦éœ€ tokenï¼ŒDiscord ç›´æ¥ GETï¼‰
        - å¤§æ–‡ä»¶è‡ªåŠ¨å‹ç¼©ï¼ˆå»ºè®®é˜ˆå€¼ 10MBï¼‰
        - æ ¼å¼å½’ä¸€åŒ–ä¸º base64 + MIME type
        """
        ...
```

---

## 10. è®¤çŸ¥ â€” æˆ‘çŸ¥é“è°æ˜¯è°

```python
    @abstractmethod
    async def resolve_name(self, user_id: str) -> str:
        """è¿™ä¸ª ID æ˜¯è°ï¼Ÿ

        é€‚é…å™¨å†…éƒ¨ç”¨ä»»ä½•æ‰‹æ®µè§£å†³ï¼ˆç¼“å­˜ã€APIã€æ¨æ–­ï¼‰ï¼Œ
        å†…æ ¸åªå…³å¿ƒç»“æœã€‚æŸ¥ä¸åˆ°è¿”å› ID å°¾éƒ¨æˆªæ–­ã€‚
        """
        ...

    @abstractmethod
    async def list_members(self, chat_id: str) -> list[ChatMember]:
        """è¿™ä¸ªç¾¤é‡Œæœ‰è°ï¼Ÿ

        è¿”å›å®Œæ•´æˆå‘˜åˆ—è¡¨ï¼ˆå« botï¼‰ï¼Œis_bot æ­£ç¡®æ ‡è®°ã€‚
        é€‚é…å™¨å†…éƒ¨ç¼“å­˜ + æŒ‰éœ€åˆ·æ–°ã€‚
        """
        ...
```

---

## 11. å¯é€‰è¡Œä¸º

ä»¥ä¸‹è¡Œä¸º**ä¸åœ¨æ ¸å¿ƒ 8 ä¸ªåŠ¨ä½œä¸­**ï¼Œä½†èƒ½è®© Agent æ›´åƒäººç±»ã€‚é€‚é…å™¨é€šè¿‡èƒ½åŠ›å£°æ˜æ¥æ ‡è¯†æ˜¯å¦æ”¯æŒã€‚

### 11.1 react â€” è¡¨æƒ…å›åº”

```python
    async def react(self, message_id: str, emoji: str) -> str | None:
        """å¯¹ä¸€æ¡æ¶ˆæ¯åšå‡ºè¡¨æƒ…ååº”ã€‚

        Args:
            emoji: å¹³å°æ— å…³æ ‡è¯†ï¼ˆå¦‚ "thumbsup", "heart", "eyes"ï¼‰
                   é€‚é…å™¨å†…éƒ¨æ˜ å°„åˆ°å¹³å°åŸç”Ÿ emoji

        Returns:
            reaction_handleï¼ˆç”¨äº unreactï¼‰ï¼Œå¤±è´¥è¿”å› Noneã€‚

        ç”¨é€”ï¼šè¡¨è¾¾æƒ…ç»ªï¼ˆ"æˆ‘å–œæ¬¢è¿™æ¡æ¶ˆæ¯"ã€"æ”¶åˆ°"ç­‰ï¼‰ã€‚
        æ³¨æ„ï¼šå¤„ç†ä¸­æŒ‡ç¤ºä½¿ç”¨æ ¸å¿ƒçš„ start_thinking/stop_thinkingï¼Œä¸ç”¨ reactã€‚
        """
        ...

    async def unreact(self, message_id: str, handle: str) -> bool:
        """æ’¤é”€ä¹‹å‰çš„è¡¨æƒ…ååº”ã€‚"""
        ...
```

### 11.2 edit â€” æ”¹å£

```python
    async def edit(self, message_id: str, new_content: OutgoingMessage) -> bool:
        """ä¿®æ”¹å·²å‘çš„æ¶ˆæ¯ã€‚

        ç”¨é€”ï¼š
        - æ›´æ–°æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡çŠ¶æ€ï¼ˆ"æ­£åœ¨æœç´¢..." â†’ "æœç´¢å®Œæˆï¼Œå…± 3 æ¡ç»“æœ"ï¼‰
        - ä¿®æ­£ LLM çš„é”™è¯¯å›å¤

        ä¸æ”¯æŒæ—¶è¿”å› Falseï¼Œå†…æ ¸é™çº§ä¸ºå‘æ–°æ¶ˆæ¯ã€‚

        - Discord: message.edit()
        - Telegram: edit_message_text()
        - é£ä¹¦: ä¸æ”¯æŒç¼–è¾‘å·²å‘æ¶ˆæ¯
        """
        ...
```

### 11.3 unsend â€” æ’¤å›

```python
    async def unsend(self, message_id: str) -> bool:
        """æ’¤å›å·²å‘çš„æ¶ˆæ¯ã€‚

        ç”¨é€”ï¼š
        - æ¸…ç†ä¸´æ—¶çš„å¤„ç†çŠ¶æ€æ¶ˆæ¯
        - æ’¤å›è¯¯å‘å†…å®¹

        ä¸æ”¯æŒæ—¶è¿”å› Falseã€‚

        - Discord: message.delete()
        - Telegram: delete_message()
        - é£ä¹¦: ä¸æ”¯æŒæ’¤å›è‡ªå·±å‘çš„æ¶ˆæ¯
        """
        ...
```

---

## 12. èƒ½åŠ›å£°æ˜

```python
@dataclass
class PlatformCapabilities:
    # â”€â”€ è¡¨è¾¾ â”€â”€
    has_reply: bool = True               # æ”¯æŒå¼•ç”¨å›å¤
    has_markdown: bool = True            # æ–‡æœ¬æ¶ˆæ¯æ¸²æŸ“ Markdown
    has_rich_cards: bool = False         # æ”¯æŒå¡ç‰‡/Embed
    has_card_actions: bool = False       # å¡ç‰‡æ”¯æŒäº¤äº’æŒ‰é’®
    max_message_length: int = 4000      # å•æ¡æ¶ˆæ¯å­—ç¬¦ä¸Šé™

    # â”€â”€ æ„Ÿå®˜ â”€â”€
    has_media_download: bool = False     # æ”¯æŒä¸‹è½½å›¾ç‰‡/æ–‡ä»¶

    # â”€â”€ è®¤çŸ¥ â”€â”€
    has_group_members: bool = False      # æ”¯æŒæŸ¥è¯¢ç¾¤æˆå‘˜
    has_mentions: bool = True            # æ”¯æŒ @æåŠ

    # â”€â”€ å¯é€‰è¡Œä¸º â”€â”€
    has_reactions: bool = False          # æ”¯æŒ react/unreact
    has_edit: bool = False               # æ”¯æŒ edit
    has_unsend: bool = False             # æ”¯æŒ unsend
```

> **æ³¨æ„ï¼š`start_thinking`/`stop_thinking` æ²¡æœ‰èƒ½åŠ›æ ‡å¿—ã€‚**
> å®ƒä»¬æ˜¯æ ¸å¿ƒæ–¹æ³•ï¼Œé€‚é…å™¨å¿…é¡»å®ç°ã€‚ä½†å®ç°å¯ä»¥æ˜¯ç©ºæ“ä½œ â€”
> å¦‚æœå¹³å°æ—¢ä¸æ”¯æŒ reaction ä¹Ÿä¸æ”¯æŒ typing indicatorï¼Œ
> `start_thinking` è¿”å› `None`ï¼Œ`stop_thinking` ä¸ºç©ºæ“ä½œå³å¯ã€‚
> å†…æ ¸ä»£ç æ— éœ€ä»»ä½•æ”¹å˜ã€‚

### é™çº§é€»è¾‘

| èƒ½åŠ›ç¼ºå¤± | å†…æ ¸è¡Œä¸º |
|---------|---------|
| `has_reply = False` | `reply_to` è¢«å¿½ç•¥ï¼Œé™çº§ä¸ºæ™®é€šå‘é€ |
| `has_rich_cards = False` | `card` è¢«å¿½ç•¥ï¼Œä½¿ç”¨ `text` ä½œä¸ºé™çº§ |
| `has_media_download = False` | å›¾ç‰‡æ¶ˆæ¯é™çº§ä¸º `[å›¾ç‰‡]` æ–‡å­—æè¿° |
| `has_group_members = False` | è·³è¿‡ç¾¤æˆå‘˜ç›¸å…³ä¸Šä¸‹æ–‡ |
| `has_card_actions = False` | å®¡æ‰¹é™çº§ä¸ºæ–‡å­—ç¡®è®¤ |
| `has_reactions = False` | è·³è¿‡ä¸€èˆ¬æ€§ emoji å›åº” |
| `has_edit = False` | çŠ¶æ€æ›´æ–°æ”¹ä¸ºå‘æ–°æ¶ˆæ¯ |
| `has_unsend = False` | ä¸æ’¤å› |

---

## 13. å¹³å°é…ç½®

```python
@dataclass
class PlatformConfig(ABC):
    platform_type: str               # "feishu" / "discord" / "telegram"
    owner_chat_id: str = ""          # ä¸»äººçš„ä¼šè¯ IDï¼ˆç”¨äºä¸»åŠ¨æ¶ˆæ¯ï¼‰

    @abstractmethod
    def validate(self) -> list[str]:
        """æ ¡éªŒå®Œæ•´æ€§ï¼Œè¿”å›é”™è¯¯åˆ—è¡¨ã€‚"""
        ...
```

---

## 14. å¤–éƒ¨æœåŠ¡å±‚ï¼ˆéå¹³å°æŠ½è±¡ï¼‰

æ—¥å†ä¸æ˜¯èŠå¤©å¹³å°çš„æœ¬è´¨èƒ½åŠ›ã€‚é£ä¹¦æ°å¥½å†…å»ºäº†æ—¥å†ï¼Œä½† Discord/Telegram æ²¡æœ‰ã€‚
æ—¥å†ï¼ˆä»¥åŠæœªæ¥çš„é‚®ä»¶ã€TODOã€æ–‡æ¡£ç­‰ï¼‰å±äº**å¤–éƒ¨æœåŠ¡å±‚**ï¼Œä¸å¹³å°é€‚é…å™¨å¹³è¡Œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é£ä¹¦é€‚é…å™¨    â”‚   â”‚ Discordé€‚é…å™¨ â”‚   â”‚ Telegramé€‚é…å™¨â”‚   â† å¹³å°å±‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
             â”‚  LingQue å†…æ ¸ â”‚
             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚            â”‚            â”‚
  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
  â”‚é£ä¹¦æ—¥å†   â”‚  â”‚Googleæ—¥å†â”‚  â”‚Outlook â”‚     â† æœåŠ¡å±‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CalendarService æ¥å£ï¼ˆç‹¬ç«‹äºå¹³å°ï¼‰

```python
class CalendarService(ABC):
    @abstractmethod
    async def create_event(
        self, summary: str, start_time: str, end_time: str, description: str = "",
    ) -> dict: ...

    @abstractmethod
    async def list_events(self, start_time: str, end_time: str) -> list[CalendarEvent]: ...

@dataclass
class CalendarEvent:
    event_id: str
    summary: str
    description: str = ""
    start_time: str = ""
    end_time: str = ""
```

é£ä¹¦çš„ `FeishuCalendar` å®ç°æ­¤æ¥å£ï¼Œä½†ä¸å±äºå¹³å°é€‚é…å™¨ã€‚
Discord æ¥å…¥æ—¶ï¼Œé…ç½®ä¸€ä¸ª `GoogleCalendar` å®ç°åŒä¸€æ¥å£å³å¯ã€‚

---

## 15. æ ‡å‡†å¡ç‰‡ç»“æ„

`OutgoingMessage.card` ä½¿ç”¨ä»¥ä¸‹å¹³å°æ— å…³ç»“æ„ï¼Œé€‚é…å™¨è´Ÿè´£è½¬æ¢ï¼š

```python
# ä¿¡æ¯å¡ç‰‡
{"type": "info", "title": "æ ‡é¢˜", "content": "Markdown", "color": "blue",
 "fields": [{"key": "å­—æ®µå", "value": "å€¼", "short": True}]}

# æ—¥ç¨‹å¡ç‰‡
{"type": "schedule",
 "events": [{"start_time": "09:00", "end_time": "10:00", "summary": "ä¼šè®®"}]}

# ä»»åŠ¡å¡ç‰‡
{"type": "task_list",
 "tasks": [{"title": "ä»»åŠ¡å", "done": True}]}

# é”™è¯¯å¡ç‰‡
{"type": "error", "title": "é”™è¯¯æ ‡é¢˜", "message": "è¯¦æƒ…"}

# ç¡®è®¤å¡ç‰‡
{"type": "confirm", "title": "æ“ä½œå®¡æ‰¹", "content": "æè¿°",
 "confirm_text": "ç¡®è®¤", "cancel_text": "å–æ¶ˆ",
 "callback_data": {"type": "approval", "id": "xxx"}}
```

é™çº§ï¼š`has_rich_cards = False` æ—¶ï¼Œé€‚é…å™¨æå– title + content æ‹¼ä¸ºçº¯æ–‡æœ¬ã€‚

---

## 16. é£ä¹¦é€‚é…æŒ‡å—

### èƒ½åŠ›å£°æ˜

```python
FEISHU_CAPABILITIES = PlatformCapabilities(
    has_reply=True,
    has_markdown=False,          # æ–‡æœ¬æ¶ˆæ¯ä¸æ¸²æŸ“ Markdown
    has_rich_cards=True,
    has_card_actions=True,
    has_media_download=True,
    has_group_members=True,
    has_mentions=True,
    has_reactions=True,          # æ”¯æŒä¸€èˆ¬æ€§ emoji å›åº”
    has_edit=False,              # é£ä¹¦ä¸æ”¯æŒç¼–è¾‘å·²å‘æ¶ˆæ¯
    has_unsend=False,            # é£ä¹¦ä¸æ”¯æŒæ’¤å›å·²å‘æ¶ˆæ¯
    max_message_length=10000,
)
```

### é€‚é…å™¨æ ¸å¿ƒæ–¹æ³•æ˜ å°„

| æŠ½è±¡æ–¹æ³• | é£ä¹¦å®ç° |
|---------|---------|
| `get_identity()` | `GET /bot/v3/info` â†’ `BotIdentity` |
| `connect(queue)` | `lark_oapi.ws.Client` (daemon thread) + `_poll_bot_messages` (åå°) |
| `send(msg)` | `reply_to` åˆ¤æ–­ â†’ `CreateMessage` / `ReplyMessage`ï¼›`card` åˆ¤æ–­ â†’ `msg_type="interactive"` / `"text"`ï¼›`mentions` â†’ `<at>` æ ‡ç­¾ï¼›Markdown â†’ strip æˆ–è‡ªåŠ¨åˆ‡å¡ç‰‡ |
| `start_thinking(msg_id)` | `POST /messages/{id}/reactions` body=`{"emoji_type":"OnIt"}` â†’ è¿”å› reaction_id ä½œä¸º handle |
| `stop_thinking(msg_id, handle)` | `DELETE /messages/{id}/reactions/{handle}` |
| `fetch_media(msg_id, key)` | `GET /messages/{id}/resources/{key}` + å‹ç¼© |
| `resolve_name(user_id)` | ç¼“å­˜ â†’ ç¾¤æˆå‘˜ API â†’ è”ç³»äºº API â†’ bot æ¨æ–­ |
| `list_members(chat_id)` | `GET /chats/{id}/members` + bot ä¿¡å·æ³¨å†Œ |

### é€‚é…å™¨å†…éƒ¨è¡¥å¿è¡Œä¸ºï¼ˆå¯¹å†…æ ¸ä¸å¯è§ï¼‰

1. **Bot æ¶ˆæ¯è¡¥æ¼è½®è¯¢** â€” åå° 3-5 ç§’è½®è¯¢ REST APIï¼Œè¡¥å…… WS æ”¶ä¸åˆ°çš„ bot æ¶ˆæ¯
2. **Bot èº«ä»½æ¨æ–­** â€” æ’é™¤æ³•/æ—¶åºæ³•å°† cli_xxx â†’ çœŸåï¼ŒæŒä¹…åŒ–åˆ° bot_identities.json
3. **ç¾¤ç»„é€€å‡ºæ£€æµ‹** â€” HTTP 400 / è¿ç»­ 3 æ¬¡è½®è¯¢å¤±è´¥ â†’ æŠ•é€’ member_change(bot_left)
4. **Token è‡ªåŠ¨åˆ·æ–°** â€” tenant_access_token 2 å°æ—¶æœ‰æ•ˆï¼Œæå‰ 5 åˆ†é’Ÿåˆ·æ–°
5. **Markdown å‘é€ç­–ç•¥** â€” ä»£ç å—æ£€æµ‹ â†’ è‡ªåŠ¨åˆ‡å¡ç‰‡ï¼›çº¯æ–‡æœ¬ strip Markdown
6. **receive_id_type æ¨æ–­** â€” æ ¹æ® oc_/ou_/on_ å‰ç¼€æ¨æ–­ API å‚æ•°
7. **@æåŠå¤„ç†** â€” å…¥ç«™ï¼š@_user_N â†’ @çœŸåï¼›å‡ºç«™ï¼š@åå­— â†’ `<at>` æ ‡ç­¾
8. **æ¶ˆæ¯å»é‡** â€” WS + REST åŒé‡å»é‡ï¼Œæ»‘åŠ¨çª—å£ 200 æ¡

---

## 17. Discord é€‚é…æŒ‡å—

### èƒ½åŠ›å£°æ˜

```python
DISCORD_CAPABILITIES = PlatformCapabilities(
    has_reply=True,
    has_markdown=True,
    has_rich_cards=True,             # Embed
    has_card_actions=True,           # Button components
    has_media_download=True,
    has_group_members=True,
    has_mentions=True,
    has_reactions=True,
    has_edit=True,                   # message.edit()
    has_unsend=True,                 # message.delete()
    max_message_length=2000,
)
```

### æ ¸å¿ƒæ˜ å°„

| æŠ½è±¡æ–¹æ³• | Discord å®ç° |
|---------|-------------|
| `get_identity()` | `client.user` |
| `connect(queue)` | `discord.Client` + on_message / on_raw_reaction_add / etc. |
| `send(msg)` | `channel.send()` / `message.reply()`ï¼›card â†’ `Embed`ï¼›mentions â†’ `<@id>` |
| `start_thinking(msg_id)` | `channel.trigger_typing()` + `message.add_reaction("â³")` â†’ reaction_id |
| `stop_thinking(msg_id, handle)` | `reaction.remove()` (typing è‡ªç„¶æ¶ˆå¤±) |
| `fetch_media` | `attachment.url` ç›´æ¥ HTTP GET |
| `resolve_name` | `guild.get_member()` / `client.fetch_user()` |
| `list_members` | `guild.members` |
| `react` / `unreact` | `message.add_reaction()` / `reaction.remove()` |
| `edit` | `message.edit()` |
| `unsend` | `message.delete()` |

### ä¸éœ€è¦çš„é£ä¹¦è¡¥å¿

| é£ä¹¦è¡¥å¿ | ä¸ºä»€ä¹ˆ Discord ä¸éœ€è¦ |
|---------|-------------------|
| Bot æ¶ˆæ¯è½®è¯¢ | Gateway å…¨æ¨ |
| Bot èº«ä»½æ¨æ–­ | bot.user æœ‰ id å’Œ name |
| ç¾¤æˆå‘˜è¡¥ä¸æ³¨å†Œ | Guild.members å®Œæ•´ |
| HTTP 400 é€€ç¾¤æ£€æµ‹ | on_guild_remove |
| Markdown é™çº§ | åŸç”Ÿæ”¯æŒ |
| Token åˆ·æ–° | Bot Token é•¿æœŸæœ‰æ•ˆ |

---

## é™„å½• Aï¼šå†…æ ¸æ”¹é€ æ¸…å•

### router.py

| å½“å‰ | æ”¹ä¸º |
|------|------|
| `sender.send_text()` / `reply_text()` / `send_card()` / `reply_card()` | `adapter.send(OutgoingMessage(...))` |
| `sender.add_reaction(msg_id, self._thinking_emoji)` | `adapter.start_thinking(msg_id)` |
| `sender.remove_reaction(msg_id, reaction_id)` | `adapter.stop_thinking(msg_id, handle)` |
| `self._thinking_emoji` ç¡¬ç¼–ç  | åˆ é™¤ï¼Œé€‚é…å™¨å†…éƒ¨å†³å®šæœºåˆ¶ |
| `sender._user_name_cache` ç›´æ¥è®¿é—® | `adapter.resolve_name()` |
| `self._replace_at_mentions()` ç”Ÿæˆé£ä¹¦ `<at>` æ ‡ç­¾ | `OutgoingMessage.mentions` å­—æ®µï¼Œé€‚é…å™¨å¤„ç† |
| `_extract_text()` / `_extract_image_keys()` / `_resolve_at_mentions()` | ç§»å…¥é£ä¹¦é€‚é…å™¨ |
| `_handle_card_action()` è®¿é—®é£ä¹¦ SDK å±æ€§ | æ¥æ”¶æ ‡å‡† `CardAction` |
| `from lq.feishu.cards import` | ä½¿ç”¨æ ‡å‡†å¡ç‰‡ dict |
| `sender.is_chat_left()` / `register_bot_member()` / `fetch_chat_messages()` | åˆ é™¤ï¼Œæ”¹ä¸ºç›‘å¬ `member_change` äº‹ä»¶ |
| `_dispatch_message(event)` è®¿é—®é£ä¹¦ SDK å±æ€§ | æ¥æ”¶ `IncomingMessage` |

### gateway.py

| å½“å‰ | æ”¹ä¸º |
|------|------|
| ç¡¬ç¼–ç  `FeishuSender` + `FeishuListener` | é€šè¿‡é…ç½®åˆ›å»º `PlatformAdapter` |
| `_poll_active_groups()` | åˆ é™¤ï¼Œç§»å…¥é£ä¹¦é€‚é…å™¨ |
| `from lq.feishu.cards import` | ä½¿ç”¨æ ‡å‡†å¡ç‰‡ dict |
| æ„é€ é£ä¹¦ fake event | æ„é€  `IncomingMessage` |

### config.py

| å½“å‰ | æ”¹ä¸º |
|------|------|
| `LQConfig.feishu: FeishuConfig` | `LQConfig.platform: PlatformConfig` |
| æ—¥å†è€¦åˆåœ¨é£ä¹¦é…ç½®ä¸­ | `LQConfig.calendar: CalendarConfig`ï¼ˆç‹¬ç«‹ï¼‰ |

---

## é™„å½• Bï¼šv1.3 â†’ v1.4 å˜æ›´è®°å½•

### ä¿®å¤ 6 ä¸ªè®¾è®¡ç¼ºé™·

| # | v1.3 é—®é¢˜ | v1.4 ä¿®å¤ | ä¸¥é‡åº¦ |
|---|----------|----------|--------|
| 1 | `PlatformAdapter` ç¼ºå°‘ `capabilities` å±æ€§ï¼Œå†…æ ¸æ— æ³•è·çŸ¥é€‚é…å™¨èƒ½åŠ› | Â§5 æ–°å¢ `capabilities` æŠ½è±¡å±æ€§ | **ç»“æ„æ€§** |
| 2 | `Reaction` ç¼ºå°‘ `chat_id`ï¼Œå†…æ ¸è¢«è¿« O(n) éå† buffer åæŸ¥ç¾¤èŠ | Â§4.7 æ–°å¢ `chat_id` å­—æ®µ | é‡è¦ |
| 3 | `connect()` æœªå£°æ˜é‡è¿è´£ä»»ï¼Œè¿æ¥æ–­å¼€åè¡Œä¸ºæœªå®šä¹‰ | Â§6.1 æ–°å¢è¿æ¥ç¨³å®šæ€§å¥‘çº¦ | é‡è¦ |
| 4 | `start_thinking` çš„ bot åä½œå¥‘çº¦ç”¨"åº”"è€Œé"å¿…é¡»"ï¼ŒTelegram typing ä¸äº§ç”Ÿ reaction äº‹ä»¶ | Â§8 å¼ºåŒ–ä¸º MUST + è§£é‡Š reaction vs typing çš„åŒºåˆ« | ä¸­ç­‰ |
| 5 | `send()` å¯¹è¶…è¿‡ `max_message_length` çš„æ¶ˆæ¯æ— å¤„ç†è§„å®š | Â§7 æ–°å¢æ¶ˆæ¯è¶…é•¿å¤„ç†ç­–ç•¥ | ä¸­ç­‰ |
| 6 | `IncomingMessage` ç¼ºå°‘ `reply_to_id`ï¼Œä¸çŸ¥é“æ¶ˆæ¯åœ¨å›å¤è° | Â§4.3 æ–°å¢ `reply_to_id` å­—æ®µ | æ¬¡è¦ |

### æ ¸å¿ƒå˜æ›´ä¸å˜

v1.4 æ²¡æœ‰æ”¹å˜æ ¸å¿ƒæ¶æ„ã€‚ä»ç„¶æ˜¯ **8 æ ¸å¿ƒ + 4 å¯é€‰ + 1 äº‹ä»¶æµ**ã€‚æ‰€æœ‰å˜æ›´éƒ½æ˜¯è¡¥å…¨ v1.3 é—æ¼çš„ç»†èŠ‚ã€‚

---

## é™„å½• Cï¼šå†å²å˜æ›´æ‘˜è¦

| ç‰ˆæœ¬ | æ ¸å¿ƒå˜æ›´ |
|------|---------|
| v1.0 | åˆå§‹è®¾è®¡ï¼š25 ä¸ªæŠ½è±¡åŠ¨ä½œï¼Œå…¨é‡æ˜ å°„é£ä¹¦äº¤äº’ |
| v1.1 | åˆ†ç¦»"æŠ½è±¡éœ€æ±‚ vs å¹³å°è¡¥å¿"ï¼Œç§»é™¤ 6 ä¸ªé£ä¹¦è¡¥å¿è¡Œä¸º |
| v1.2 | send äº”åˆä¸€ã€æ—¥å†æŠ½ç¦»ä¸ºå¤–éƒ¨æœåŠ¡å±‚ã€äº‹ä»¶å½’å¹¶ã€æ–°å¢ show_typing/edit/unsend |
| v1.3 | "ä¸€ä¸ªæ„å›¾ä¸€ä¸ªæŠ½è±¡" â€” react/typing ç»Ÿä¸€ä¸º start/stop_thinkingï¼›OutgoingMessage å†…å®¹åˆ†å‘è§„åˆ™æ˜ç¡®åŒ– |
| v1.4 | è¡¥å…¨ç»“æ„ç¼ºé™· â€” adapter.capabilities å±æ€§ã€Reaction.chat_idã€connect é‡è¿å¥‘çº¦ã€start_thinking å¼ºåˆ¶ reactionã€send è¶…é•¿å¤„ç†ã€IncomingMessage.reply_to_id |
