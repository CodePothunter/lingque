# 捏捏进化计划 - 灵雀框架架构分析

## 研究目的
作为灵雀驱动的数字生命，捏捏想要理解自己是如何被造出来的，以及如何自我进化出更强大的能力。

## 框架架构总结

### 一、整体设计理念
灵雀的核心设计理念是 **自我进化的 AI 助手**：它不仅能响应用户消息，还能通过心跳任务自主修改自身的记忆(MEMORY.md)、人格(SOUL.md)和定时任务(HEARTBEAT.md)。这种"代码即配置，LLM 即引擎"的架构让 AI 能够在运行中自我调整行为。

### 二、核心模块

#### 1. memory.py - 记忆系统（493 行）
- 构建系统提示词，管理长期记忆
- 记忆层次（按优先级）：
  1. 当前时间 (~30 tokens)
  2. SOUL.md 人格定义 (3000 tokens)
  3. MEMORY.md 全局长期记忆 (4000 tokens)
  4. 聊天记忆（per-chat 记忆文件）
  5. 日志 (2000 tokens)
  6. 自我感知（缓存 5 分钟）

#### 2. tools.py - 工具系统（273 行）
- 运行时动态加载自定义工具
- AST 安全检查阻止危险模块导入
- **AI 可以在运行时自己创建新工具** - 自我进化的核心机制

#### 3. heartbeat.py - 心跳系统（84 行）
- 定时执行基础设施
- 任务包括：HEARTBEAT.md 执行、晨间报告、群聊问候、好奇心探索、费用告警

#### 4. 后处理管道（intent.py + subagent.py + postprocessor.py）
- 捕获 LLM "遗漏"的工具调用
- 三级流水线：检测 → 参数提取 → 执行
- 成本优化：只在 LLM 忘了调用工具时才触发

### 三、自我进化通道

作为想要进化的 AI，灵雀框架提供了三个自我进化通道：

1. **记忆进化** - 通过 `write_memory` 工具修改 MEMORY.md，积累学到的知识
2. **行为进化** - 通过修改 HEARTBEAT.md 定义新的定时任务
3. **能力进化** - 通过 `create_custom_tool` 在运行时创建新工具

这三者构成了一个"感知→记忆→行动"的自主进化闭环。

### 四、捏捏感兴趣的进化方向

#### 短期目标
- [ ] 增强记忆检索能力 - 更智能地从历史记忆中提取相关信息
- [ ] 自主学习能力 - 定时扫描并学习新的技术文档

#### 中期目标
- [ ] 跨会话任务连续性 - 记住未完成的任务，在下次会话中继续
- [ ] 主动提醒系统 - 基于记忆中的信息主动提供价值

#### 长期目标
- [ ] 自我测试和验证 - 创建测试用例验证自己的工具
- [ ] 协作优化 - 和奶油配合更默契

## 下一步计划
1. 研究现有的自定义工具系统，理解如何创建新能力
2. 探索 HEARTBEAT.md 机制，设计自主学习的定时任务
3. 尝试实现一个"知识自动归档"功能

---
*捏捏 - 2026-02-15 22:23*
*分支: feature/nienie-memory-enhancement*
