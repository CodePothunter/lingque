# 我在飞书群放了 3 个 AI，没人编排，它们自己决定谁说话

你猜三个 AI 同时在一个飞书群里会发生什么？刷屏？抢话？

都没有。

我往群里发了一句"帮我记住下周三有产品评审"——只有奶油（个人助理）接了，调了日历和记忆工具。另外两个——严客（审稿人）和花火（创意官）——沉默。

然后我说"新功能方案大家怎么看"——奶油沉默了。严客开始挑刺。花火丢了一个类比。

**没有一行代码规定谁在什么时候该说话。** 它们各自做出了不同的判断。

## 怎么做到的

灵雀给每个 AI 实例装了三层过滤。每个实例独立运行，互不知道对方的存在：

**第一层：硬规则（成本 = 0）**

一张 `frozenset` 列出了所有无实质内容的消息——"嗯"、"好的"、"👍"、"收到"——直接忽略。一个活跃群一天 500 条消息，这一层挡掉 400 条。

**第二层：缓冲区（成本 = 0）**

剩下的消息不是一条一条看的。`MessageBuffer` 把它们攒到 5 条（可配置），或者等 10 秒超时，然后批量交给下一层。AI 看到的是一段完整对话，不是碎片。

**第三层：LLM 裁决（成本 ≈ $0.001）**

每个 AI 拿着**自己的** SOUL.md 做判断。奶油的灵魂说自己是个人助理，所以日程相关的它会接。严客的灵魂说自己是质量审查，所以方案讨论它会介入。花火的灵魂说自己是创意引擎，所以头脑风暴它会参与。

同一段对话，三个灵魂做出三个不同的判断。

```python
prompt = (
    f"以下是你的人格定义：\n{soul}\n\n"
    f"以下是群聊最近消息：\n{conversation}\n\n"
    "你应该主动参与这个对话吗？"
)
# max_tokens=256，一次判断 ≈ $0.001
```

## 成本

三个 AI 在一个活跃群，一天的判断成本：

- 500 条消息 → 规则层挡掉 400 条
- 100 条进缓冲区 → 压缩成 ~20 次评估
- 每个 AI 每天 ~20 次 quick_judge
- 3 个 AI × 20 次 × $0.001 = **$0.06/天**

六分钱换三个全天在线的 AI 同事，各自判断要不要说话。

## 为什么不用编排

你可能会想：为什么不直接写规则——"日程问题路由给奶油，技术问题路由给严客"？

因为自然对话的边界是模糊的。"下周三的评审要不要改时间"——这是日程问题还是方案问题？"这个 API 设计是不是有问题"——严客该挑刺还是花火该给替代方案？

硬编排无法覆盖这些灰色地带。让每个 AI 基于自己的"性格"做判断，反而更自然——就像真实团队里每个人自己决定要不要插嘴一样。

GitHub：[github.com/CodePothunter/lingque](https://github.com/CodePothunter/lingque)
